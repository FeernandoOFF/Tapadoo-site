<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Blog | Tapadoo </title><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><meta name="next-head-count" content="6"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/Tapadoo-site/_next/static/css/2ed2c0bec5e20295.css" as="style"/><link rel="stylesheet" href="/Tapadoo-site/_next/static/css/2ed2c0bec5e20295.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/Tapadoo-site/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/Tapadoo-site/_next/static/chunks/webpack-461e027a94344cdf.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/framework-715a76d8b0695da7.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/main-baed5792d4d394cf.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/pages/_app-c68c249bf95195e7.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/996-f765e51b6a74c60f.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/402-722b6745331d1e2f.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/249-64ffefb1c9b95e63.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/pages/blog/post/%5Bslug%5D-daf066f3e0730dd6.js" defer=""></script><script src="/Tapadoo-site/_next/static/e5CLx98aCviI1Ch3bv1Ek/_buildManifest.js" defer=""></script><script src="/Tapadoo-site/_next/static/e5CLx98aCviI1Ch3bv1Ek/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;300;400;500;600;700&display=swap">@font-face{font-family:'Montserrat';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Uw9.woff) format('woff')}@font-face{font-family:'Montserrat';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCs16Ew9.woff) format('woff')}@font-face{font-family:'Montserrat';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Ew9.woff) format('woff')}@font-face{font-family:'Montserrat';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtZ6Ew9.woff) format('woff')}@font-face{font-family:'Montserrat';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCu170w9.woff) format('woff')}@font-face{font-family:'Montserrat';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCuM70w9.woff) format('woff')}@font-face{font-family:'Montserrat';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WRhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Montserrat';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459W1hyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Montserrat';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WZhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Montserrat';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WdhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Montserrat';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WlhyyTh89Y.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Montserrat';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WRhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Montserrat';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459W1hyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Montserrat';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WZhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Montserrat';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WdhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Montserrat';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WlhyyTh89Y.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Montserrat';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WRhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Montserrat';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459W1hyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Montserrat';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WZhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Montserrat';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WdhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Montserrat';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WlhyyTh89Y.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Montserrat';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WRhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Montserrat';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459W1hyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Montserrat';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WZhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Montserrat';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WdhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Montserrat';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WlhyyTh89Y.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Montserrat';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WRhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Montserrat';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459W1hyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Montserrat';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WZhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Montserrat';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WdhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Montserrat';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WlhyyTh89Y.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Montserrat';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WRhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Montserrat';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459W1hyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Montserrat';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WZhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Montserrat';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WdhyyTh89ZNpQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Montserrat';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WlhyyTh89Y.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="bg-base-100 shadow-sm z-50"><header class="navbar max-w-7xl mx-auto "><div class="navbar-start"><a href="/Tapadoo-site"><img src="/Tapadoo-site/_next/static/media/tapadoo-large-logo.b51a8a63.png" alt="Tapadoo logo" class="w-full max-w-[120px] cursor-pointer"/></a></div><div class="navbar-end md:hidden flex"><div class="dropdown dropdown-left"><label tabindex="0" class="btn btn-ghost lg:hidden"><button><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor"></path><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor"></path><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor"></path></svg></button></label><ul class="menu menu-compact dropdown-content mt-3 p-2 shadow bg-base-100 rounded-box w-52 z-50"><li><a class="font-semibold  " href="/Tapadoo-site/tapadoo/about">Tapadoo</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/about">Who are you?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/localization">Where are you based?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/work">Who do you work with?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/careers">Are you hiring?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/contact">Get in touch</a></li><li><a class="font-semibold  " href="/Tapadoo-site/apps/requisites">Apps</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/requisites">Do I need an app?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/costs">How much does an app cost?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/success-cases">Case Studies</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/process">Process</a></li><li><a class="font-semibold  " href="/Tapadoo-site/blog/1">Blog</a></li></ul></div></div><div class="navbar-end hidden md:flex"><ul class="menu menu-horizontal p-0"><li><a class="  " href="/Tapadoo-site/tapadoo/about">Tapadoo</a></li><li><a class="  " href="/Tapadoo-site/apps/requisites">Apps</a></li><li><a class="  " href="/Tapadoo-site/blog/1">Blog</a></li></ul></div></header></div><main class="min-h-[70vh] relative"> <div class="p-4 max-w-5xl mx-auto mt-[5vh]"><figure><img src="https://2upm2b1wdft320vzjj34rpga-wpengine.netdna-ssl.com/wp-content/uploads/2019/05/apple-black-and-white-black-and-white-169573.jpg.webp" alt="Swift JSON Date FormattingTapadoo blog" class="rounded-xl max-w-[90vw] mx-auto w-full"/></figure><section class="mb-10"><h1 class="app-title my-8">Swift JSON Date Formatting</h1><div class="categories"><p class="my-4 text-lg font-medium">Tags : </p><p class="p-2 text-xs px-4 bg-neutral rounded-lg inline-block text-gray-100 font-semibold cursor-pointer">development</p></div><div class="w-full bg-neutral h-[1px] my-8 opacity-60"></div><p class="blog-text text-justify">Confused by fractional components appearing in your JSON when using unix timestamps?</p>
<p class="blog-text text-justify">See the custom formatters below for a way to get back to integers if that&#x27;s what you need for your API</p>
<p class="blog-text text-justify">JSON is the de facto way of sending and receiving data from APIs these days. And for iOS developers, Swift has made things easier in recent years with the introduction of Codable. Codable is a way to quickly encode and decode objects to and from JSON. The defaults are pretty good, and the options like key decoding strategy to auto convert from snake case to camel case has been a blessing.</p>
<p class="blog-text text-justify">However, one place where the defaults seem oddly incorrect is Date properties. The default JSON date format output is not very helpful. Take the following playground for example.</p>
<pre><code>import UIKit

/////////////////////////////////////////////////////////////

let event = Event(name: &quot;Test Event&quot;, widgetCount: 10, timestamp: Date())
print(event)
printJson(event)

/////////////////////////////////////////////////////////////

struct Event: Codable {

    let name: String
    let widgetCount: Int
    let timestamp: Date

}

extension Event: CustomDebugStringConvertible {
    var debugDescription: String {
        return &quot;[\(timestamp)] \(name)&quot;
    }
}


func printJson&lt;T: Encodable&gt;(_ obj: T) throws {
    let enc = JSONEncoder()
    enc.outputFormatting = [.prettyPrinted , .sortedKeys]

    let jsonData = try enc.encode(obj)
    let jsonString = String(data: jsonData, encoding: .utf8)

    print(jsonString!)
}
</code></pre>
<p class="blog-text text-justify">The output is the following, a debug print out and the json print out:</p>
<pre><code>[2019-04-24 16:06:09 +0000] Test Event
{
  &quot;name&quot; : &quot;Test Event&quot;,
  &quot;timestamp&quot; : 577814769.81546402,
  &quot;widgetCount&quot; : 10
}
</code></pre>
<p class="blog-text text-justify">The JSON date format for a <code>Date</code> got the value of <code>577814769.81546402</code>. This almost looks like a unix epoch timestamp, but if you put it into an online converter it&#x27;ll come out as 04/23/1988 @ 4:06pm.</p>
<p class="blog-text text-justify">It&#x27;s not a unix timestamp. It&#x27;s actually using a different reference date - 2001 instead of 1970. This might be fine for Foundations internals, CoreData, etc. But in all my years of communicating with APIs of varying degrees, I&#x27;ve never once seen a Remote API Spec that used that as a reference date.</p>
<h2 class="blog-subtitle ">Changing The Default Format</h2>
<p class="blog-text text-justify">If you need to use a different format for only a single property, you may need to implement a custom <code>encode(to encoder: Encoder)</code> function, or use an intermediary model object. But ideally you are using the same JSON date format across all date properties in which case changing the format of the Date in the JSON is easy enough. <code>JSONEncoder</code> has a <code>dateEncodingStrategy</code> which <a class="text-primary " href="https://developer.apple.com/documentation/foundation/jsonencoder/dateencodingstrategy">supports several formats</a></p>
<p class="blog-text text-justify">JSONEncoder can be configured like so:</p>
<pre><code>let enc = JSONEncoder()
    enc.outputFormatting = [.prettyPrinted , .sortedKeys]

    //Like this
    enc.dateEncodingStrategy = .iso8601

    //OR this
    enc.dateEncodingStrategy = .secondsSince1970

    //or this (but not really)
    let sillyFormatter = DateFormatter()
    sillyFormatter.locale = Locale(identifier: &quot;en_US_POSIX&quot;)
    sillyFormatter.dateFormat = &quot;EEEE, MMM d, yyyy &#x27;at&#x27; HH:mm&quot;
    enc.dateEncodingStrategy = .formatted(sillyFormatter)
</code></pre>
<p class="blog-text text-justify">and would now give an output like so:</p>
<pre><code>// Or
{
  &quot;name&quot; : &quot;Test Event&quot;,
  &quot;timestamp&quot; : &quot;2019-04-25T11:07:19Z&quot;,
  &quot;widgetCount&quot; : 10
}

// Or
{
  &quot;name&quot; : &quot;Test Event&quot;,
  &quot;timestamp&quot; : 1556190419.3267961,
  &quot;widgetCount&quot; : 10
}

// Or
{
  &quot;name&quot; : &quot;Test Event&quot;,
  &quot;timestamp&quot; : &quot;Thursday, Apr 25, 2019 at 11:55&quot;,
  &quot;widgetCount&quot; : 10
}
</code></pre>
<p class="blog-text text-justify">The first example, iso8601 is pretty common (and what you should probably use if you control both client and server).</p>
<p class="blog-text text-justify">The second example is a unix epoch timestamp.</p>
<p class="blog-text text-justify">The 3rd example is a bit silly - it&#x27;s extremely unlikely that an API server would be expecting dates formatted like this. But if you did need to customise the date string, that&#x27;s the easiest way to do it.</p>
<h2 class="blog-subtitle ">Custom Formats</h2>
<p class="blog-text text-justify">But focusing on the second example, the unix timestamp. A value of <code>1556190419.3267961</code> is a little unusual to me personally, as I’m not used to seeing the fractional component. To me, unix time stamps are integers. And some API designers out there seem to think the same. While some APIs do use this format, slacks API for example return timestamps like this - but some APIs may not like this.</p>
<p class="blog-text text-justify">If you have control over the API or can suggest changes ideally use this decimal format, it&#x27;s more accurate. But if the API is out of your control, you may need to ensure it&#x27;s an integer and not a decimal in your request, you can use a custom formatter like so:</p>
<pre><code>    let enc = JSONEncoder()
    enc.outputFormatting = [.prettyPrinted , .sortedKeys]

    enc.dateEncodingStrategy = .custom({ date, encoder in
        let seconds = Int(date.timeIntervalSince1970)
        var singleValueEnc = encoder.singleValueContainer()
        try singleValueEnc.encode(seconds)
    })
</code></pre>
<p class="blog-text text-justify">which gives us:</p>
<pre><code>{
  &quot;name&quot; : &quot;Test Event&quot;,
  &quot;timestamp&quot; : 1556205171,
  &quot;widgetCount&quot; : 10
}
</code></pre>
<p class="blog-text text-justify">Now our integer assuming API won&#x27;t be complaining.</p>
<p class="blog-text text-justify">This custom encoder approach would allow us to also represent dates as a completely different structure if needs be, without having to have our Event struct and all other model classes in our application being written using something other than the Date class:</p>
<pre><code>func encodeDateAsObject(_ date: Date, _ encoder: Encoder) throws {

    enum DateParts: CodingKey {
        case year,month,day,hour,minute,second
    }

    var container = encoder.container(keyedBy: DateParts.self)

    var cal = Calendar(identifier: .gregorian)
    cal.locale = Locale(identifier: &quot;en_US_POSIX&quot;)
    cal.timeZone = TimeZone(identifier: &quot;UTC&quot;)!

    let dateComponents = cal.dateComponents([.year,.month,.day,.hour,.minute,.second], from: date)

    try container.encode(dateComponents.year!, forKey: DateParts.year)
    try container.encode(dateComponents.month!, forKey: DateParts.month)
    try container.encode(dateComponents.day!, forKey: DateParts.day)
    try container.encode(dateComponents.hour!, forKey: DateParts.hour)
    try container.encode(dateComponents.minute!, forKey: DateParts.minute)
    try container.encode(dateComponents.second!, forKey: DateParts.second)
}

// and then

    let enc = JSONEncoder()
    enc.outputFormatting = [.prettyPrinted , .sortedKeys]
    enc.dateEncodingStrategy = .custom(encodeDateAsObject)
</code></pre>
<p class="blog-text text-justify">This results in the following output being used for our API, while our <code>Event</code> struct continues to keep its property defined as <code>timestamp: Date</code> :</p>
<pre><code>{
  &quot;name&quot; : &quot;Test Event&quot;,
  &quot;timestamp&quot; : {
    &quot;day&quot; : 25,
    &quot;hour&quot; : 15,
    &quot;minute&quot; : 22,
    &quot;month&quot; : 4,
    &quot;second&quot; : 48,
    &quot;year&quot; : 2019
  },
  &quot;widgetCount&quot; : 10
}
</code></pre>
<h2 class="blog-subtitle ">Default Locale Issues</h2>
<p class="blog-text text-justify">As an aside, it&#x27;s worth noting the use of <code>en_US_POSIX</code> as a locale for the formatter in the examples above. There&#x27;s a good chance the API server is expecting timestamps to be in UTC time rather than a specific local time, and also expects 24hr time, Gregorian calendar, etc.</p>
<p class="blog-text text-justify">If the locale is left as a default, behaviour might not be as expected depending on device settings. The lack of a fixed, server-specific locale when encoding data for APIs or decoding data from APIs is a common cause of issues we&#x27;ve encountered in the past. And if you are developing code in a location like Ireland where most people use 24hr clocks and are in UTC time zone for half the year it&#x27;s very easy to slip by unnoticed.</p>
<p class="blog-text text-justify">Apple have a tech note specifically about this: <a class="text-primary " href="https://developer.apple.com/library/archive/qa/qa1480/_index.html">https://developer.apple.com/library/archive/qa/qa1480/_index.html</a></p>
<p class="blog-text text-justify">This applies only to formats for communication between machines like a phone and a remote API server. For displaying dates to the user, you are usually best served by using the users default locale.</p>
<h2 class="blog-subtitle ">Other Resources</h2>
<p class="blog-text text-justify">For other resources on date formatting &amp; Swift codables, see:</p>
<ul>
<li class="list-disc ml-5 my-1">https://nsdateformatter.com/</li>
<li class="list-disc ml-5 my-1">https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types</li>
<li class="list-disc ml-5 my-1">https://www.swiftbysundell.com/basics/codable</li>
<li class="list-disc ml-5 my-1">https://developer.apple.com/library/archive/qa/qa1480/_index.html</li>
</ul>
<p class="blog-text text-justify">Jason Connery</p></section></div> </main><footer class="p-10 bg-[#eeeeee90] text-[#A09893] "><div class="app-container footer"><div><img src="/Tapadoo-site/_next/static/media/tapadoo-large-logo.b51a8a63.png" alt="Tapadoo logo" class="w-full max-w-[120px] cursor-pointer grayscale"/><div class="my-4"><a href="https://goo.gl/maps/8Q1WtLmA8t41bNnJ6"><p aria-label="Tapadoo location" class="my-2">26-28 Strand Street Great, Dublin 1 </p></a><a href="mailto:enquiries@tapadoo.com "><p aria-label="Tapadoo mail" class="">enquiries@tapadoo.com </p></a></div><a href="tel:+353 1 555 222 4"><p aria-label="Tapadoo Phone" class="">+353 1 555 222 4</p></a></div><div><span class="footer-title">Links</span><a class="link link-hover" href="/Tapadoo-site/tapadoo/contact">Privacy Policy</a></div><div><span class="footer-title">Company</span><a class="link link-hover" href="/Tapadoo-site/tapadoo/about">About us</a><a class="link link-hover" href="/Tapadoo-site/tapadoo/careers">Careers</a><a class="link link-hover" href="/Tapadoo-site/apps/costs">Pricing</a><a class="link link-hover" href="/Tapadoo-site/blog/1">Blog</a></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Swift JSON Date Formatting","date":"2019-07-29","content":"\nConfused by fractional components appearing in your JSON when using unix timestamps?\n\nSee the custom formatters below for a way to get back to integers if that's what you need for your API\n\nJSON is the de facto way of sending and receiving data from APIs these days. And for iOS developers, Swift has made things easier in recent years with the introduction of Codable. Codable is a way to quickly encode and decode objects to and from JSON. The defaults are pretty good, and the options like key decoding strategy to auto convert from snake case to camel case has been a blessing.\n\nHowever, one place where the defaults seem oddly incorrect is Date properties. The default JSON date format output is not very helpful. Take the following playground for example.\n\n```\nimport UIKit\n\n/////////////////////////////////////////////////////////////\n\nlet event = Event(name: \"Test Event\", widgetCount: 10, timestamp: Date())\nprint(event)\nprintJson(event)\n\n/////////////////////////////////////////////////////////////\n\nstruct Event: Codable {\n\n    let name: String\n    let widgetCount: Int\n    let timestamp: Date\n\n}\n\nextension Event: CustomDebugStringConvertible {\n    var debugDescription: String {\n        return \"[\\(timestamp)] \\(name)\"\n    }\n}\n\n\nfunc printJson\u003cT: Encodable\u003e(_ obj: T) throws {\n    let enc = JSONEncoder()\n    enc.outputFormatting = [.prettyPrinted , .sortedKeys]\n\n    let jsonData = try enc.encode(obj)\n    let jsonString = String(data: jsonData, encoding: .utf8)\n\n    print(jsonString!)\n}\n```\n\nThe output is the following, a debug print out and the json print out:\n\n```\n[2019-04-24 16:06:09 +0000] Test Event\n{\n  \"name\" : \"Test Event\",\n  \"timestamp\" : 577814769.81546402,\n  \"widgetCount\" : 10\n}\n```\n\nThe JSON date format for a `Date` got the value of `577814769.81546402`. This almost looks like a unix epoch timestamp, but if you put it into an online converter it'll come out as 04/23/1988 @ 4:06pm.\n\nIt's not a unix timestamp. It's actually using a different reference date - 2001 instead of 1970. This might be fine for Foundations internals, CoreData, etc. But in all my years of communicating with APIs of varying degrees, I've never once seen a Remote API Spec that used that as a reference date.\n\n## Changing The Default Format\n\nIf you need to use a different format for only a single property, you may need to implement a custom `encode(to encoder: Encoder)` function, or use an intermediary model object. But ideally you are using the same JSON date format across all date properties in which case changing the format of the Date in the JSON is easy enough. `JSONEncoder` has a `dateEncodingStrategy` which [supports several formats](https://developer.apple.com/documentation/foundation/jsonencoder/dateencodingstrategy)\n\nJSONEncoder can be configured like so:\n\n```\nlet enc = JSONEncoder()\n    enc.outputFormatting = [.prettyPrinted , .sortedKeys]\n\n    //Like this\n    enc.dateEncodingStrategy = .iso8601\n\n    //OR this\n    enc.dateEncodingStrategy = .secondsSince1970\n\n    //or this (but not really)\n    let sillyFormatter = DateFormatter()\n    sillyFormatter.locale = Locale(identifier: \"en_US_POSIX\")\n    sillyFormatter.dateFormat = \"EEEE, MMM d, yyyy 'at' HH:mm\"\n    enc.dateEncodingStrategy = .formatted(sillyFormatter)\n```\n\nand would now give an output like so:\n\n```\n// Or\n{\n  \"name\" : \"Test Event\",\n  \"timestamp\" : \"2019-04-25T11:07:19Z\",\n  \"widgetCount\" : 10\n}\n\n// Or\n{\n  \"name\" : \"Test Event\",\n  \"timestamp\" : 1556190419.3267961,\n  \"widgetCount\" : 10\n}\n\n// Or\n{\n  \"name\" : \"Test Event\",\n  \"timestamp\" : \"Thursday, Apr 25, 2019 at 11:55\",\n  \"widgetCount\" : 10\n}\n```\n\nThe first example, iso8601 is pretty common (and what you should probably use if you control both client and server).\n\nThe second example is a unix epoch timestamp.\n\nThe 3rd example is a bit silly - it's extremely unlikely that an API server would be expecting dates formatted like this. But if you did need to customise the date string, that's the easiest way to do it.\n\n## Custom Formats\n\nBut focusing on the second example, the unix timestamp. A value of `1556190419.3267961` is a little unusual to me personally, as I’m not used to seeing the fractional component. To me, unix time stamps are integers. And some API designers out there seem to think the same. While some APIs do use this format, slacks API for example return timestamps like this - but some APIs may not like this.\n\nIf you have control over the API or can suggest changes ideally use this decimal format, it's more accurate. But if the API is out of your control, you may need to ensure it's an integer and not a decimal in your request, you can use a custom formatter like so:\n\n```\n    let enc = JSONEncoder()\n    enc.outputFormatting = [.prettyPrinted , .sortedKeys]\n\n    enc.dateEncodingStrategy = .custom({ date, encoder in\n        let seconds = Int(date.timeIntervalSince1970)\n        var singleValueEnc = encoder.singleValueContainer()\n        try singleValueEnc.encode(seconds)\n    })\n```\n\nwhich gives us:\n\n```\n{\n  \"name\" : \"Test Event\",\n  \"timestamp\" : 1556205171,\n  \"widgetCount\" : 10\n}\n```\n\nNow our integer assuming API won't be complaining.\n\nThis custom encoder approach would allow us to also represent dates as a completely different structure if needs be, without having to have our Event struct and all other model classes in our application being written using something other than the Date class:\n\n```\nfunc encodeDateAsObject(_ date: Date, _ encoder: Encoder) throws {\n\n    enum DateParts: CodingKey {\n        case year,month,day,hour,minute,second\n    }\n\n    var container = encoder.container(keyedBy: DateParts.self)\n\n    var cal = Calendar(identifier: .gregorian)\n    cal.locale = Locale(identifier: \"en_US_POSIX\")\n    cal.timeZone = TimeZone(identifier: \"UTC\")!\n\n    let dateComponents = cal.dateComponents([.year,.month,.day,.hour,.minute,.second], from: date)\n\n    try container.encode(dateComponents.year!, forKey: DateParts.year)\n    try container.encode(dateComponents.month!, forKey: DateParts.month)\n    try container.encode(dateComponents.day!, forKey: DateParts.day)\n    try container.encode(dateComponents.hour!, forKey: DateParts.hour)\n    try container.encode(dateComponents.minute!, forKey: DateParts.minute)\n    try container.encode(dateComponents.second!, forKey: DateParts.second)\n}\n\n// and then\n\n    let enc = JSONEncoder()\n    enc.outputFormatting = [.prettyPrinted , .sortedKeys]\n    enc.dateEncodingStrategy = .custom(encodeDateAsObject)\n```\n\nThis results in the following output being used for our API, while our `Event` struct continues to keep its property defined as `timestamp: Date` :\n\n```\n{\n  \"name\" : \"Test Event\",\n  \"timestamp\" : {\n    \"day\" : 25,\n    \"hour\" : 15,\n    \"minute\" : 22,\n    \"month\" : 4,\n    \"second\" : 48,\n    \"year\" : 2019\n  },\n  \"widgetCount\" : 10\n}\n```\n\n## Default Locale Issues\n\nAs an aside, it's worth noting the use of `en_US_POSIX` as a locale for the formatter in the examples above. There's a good chance the API server is expecting timestamps to be in UTC time rather than a specific local time, and also expects 24hr time, Gregorian calendar, etc.\n\nIf the locale is left as a default, behaviour might not be as expected depending on device settings. The lack of a fixed, server-specific locale when encoding data for APIs or decoding data from APIs is a common cause of issues we've encountered in the past. And if you are developing code in a location like Ireland where most people use 24hr clocks and are in UTC time zone for half the year it's very easy to slip by unnoticed.\n\nApple have a tech note specifically about this: [https://developer.apple.com/library/archive/qa/qa1480/\\_index.html](https://developer.apple.com/library/archive/qa/qa1480/_index.html)\n\nThis applies only to formats for communication between machines like a phone and a remote API server. For displaying dates to the user, you are usually best served by using the users default locale.\n\n## Other Resources\n\nFor other resources on date formatting \u0026 Swift codables, see:\n\n- https://nsdateformatter.com/\n- https://developer.apple.com/documentation/foundation/archives\\_and\\_serialization/encoding\\_and\\_decoding\\_custom\\_types\n- https://www.swiftbysundell.com/basics/codable\n- https://developer.apple.com/library/archive/qa/qa1480/\\_index.html\n\nJason Connery\n","postImage":"https://2upm2b1wdft320vzjj34rpga-wpengine.netdna-ssl.com/wp-content/uploads/2019/05/apple-black-and-white-black-and-white-169573.jpg.webp","categories":["development"],"tags":["ios","swift"]}},"__N_SSG":true},"page":"/blog/post/[slug]","query":{"slug":"swift-json-date-formatting"},"buildId":"e5CLx98aCviI1Ch3bv1Ek","assetPrefix":"/Tapadoo-site","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>
<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Blog | Tapadoo </title><meta name="next-head-count" content="3"/><link rel="preload" href="/Tapadoo-site/_next/static/css/232a30425848af9b.css" as="style"/><link rel="stylesheet" href="/Tapadoo-site/_next/static/css/232a30425848af9b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/Tapadoo-site/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/Tapadoo-site/_next/static/chunks/webpack-461e027a94344cdf.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/framework-715a76d8b0695da7.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/main-baed5792d4d394cf.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/pages/_app-c68c249bf95195e7.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/996-f765e51b6a74c60f.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/402-722b6745331d1e2f.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/pages/blog/post/%5Bslug%5D-85a3e3efd6d46107.js" defer=""></script><script src="/Tapadoo-site/_next/static/jG6HNdE2cjk8s5SucJ8mC/_buildManifest.js" defer=""></script><script src="/Tapadoo-site/_next/static/jG6HNdE2cjk8s5SucJ8mC/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-base-100 shadow-sm"><header class="navbar max-w-7xl mx-auto "><div class="navbar-start"><a href="/Tapadoo-site"><img src="/Tapadoo-site/_next/static/media/tapadoo-large-logo.b51a8a63.png" alt="Tapadoo logo" class="w-full max-w-[120px] cursor-pointer"/></a></div><div class="navbar-end md:hidden flex"><div class="dropdown dropdown-left"><label tabindex="0" class="btn btn-ghost lg:hidden"><button><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor"></path><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor"></path><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor"></path></svg></button></label><ul class="menu menu-compact dropdown-content mt-3 p-2 shadow bg-base-100 rounded-box w-52"><li><a class="font-semibold  " href="/Tapadoo-site/tapadoo/about">Tapadoo</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/about">Who are you?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/localization">Where are you based?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/work">Who do you work with?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/careers">Are you hiring?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/contact">Get in touch</a></li><li><a class="font-semibold  " href="/Tapadoo-site/apps/requisites">Apps</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/requisites">Do I need an app?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/costs">How much does an app cost?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/success-cases">Case Studies</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/process">Process</a></li><li><a class="font-semibold  " href="/Tapadoo-site/blog/1">Blog</a></li></ul></div></div><div class="navbar-end hidden md:flex"><ul class="menu menu-horizontal p-0"><li><a class="  " href="/Tapadoo-site/tapadoo/about">Tapadoo</a></li><li><a class="  " href="/Tapadoo-site/apps/requisites">Apps</a></li><li><a class="  " href="/Tapadoo-site/blog/1">Blog</a></li></ul></div></header></div><main class="min-h-[70vh] relative"> <div class="p-4 max-w-5xl mx-auto mt-[5vh]"><figure><img src="https://2upm2b1wdft320vzjj34rpga-wpengine.netdna-ssl.com/wp-content/uploads/2019/04/Screenshot-2019-04-25-10.32.45.png.webp" alt="Simple Rules for managing Push TokensTapadoo blog" class="rounded-xl max-w-[90vw] mx-auto w-full"/></figure><section class="mb-10"><h1 class="app-title my-8">Simple Rules for managing Push Tokens</h1><div class="w-full bg-neutral h-[1px] my-8 opacity-60"></div><p class="blog-text text-justify">Sometimes, we develop an app for customers where they are implementing their own back-end services. The issue of handling push tokens regularly comes up. Often, the business logic may seem difficult to manage all the scenarios, but it really isn&#x27;t that difficult. Let&#x27;s take a typical example. In most cases, your service will want to associate a push token with a user on your service. Imagine your app is a shop, and you want to be able to send a push notification when a product ships.</p>
<p class="blog-text text-justify">Firstly a little background on how push works. Essentially there a couple of aspects to push:</p>
<ol>
<li class="list-disc ml-5 my-1">Push is decided by a user permission. The first time an app wishes to use push, the operating system will kick in and ask the user&#x27;s permission. If the user doesn&#x27;t want to receive push, they can say no. This is the end of it. You won&#x27;t get any tokens. This is fine. You&#x27;re meant to respect the user&#x27;s wishes. In this case the user is saying &quot;Don&#x27;t tell me when my product ships, I&#x27;ll come back and check myself&quot;</li>
<li class="list-disc ml-5 my-1">If permission is granted, the app will request a push token from the network (i.e. from Apple or Google depending on iOS or Android).</li>
<li class="list-disc ml-5 my-1">The token will be given by the network. It represents a unique device <em>and an app</em>. I.e. any push sent to this token will be delivered to this device and this app on the device only.</li>
<li class="list-disc ml-5 my-1">Typically, your app code will hand this token to the server to be associated with the logged in user to the service (i.e. &quot;which user is logged into this online shop? this is now their token which you can use to let them know when their next purchase ships&quot;)</li>
<li class="list-disc ml-5 my-1">When the business conditions are fulfilled, the server will initiate the push. So, for example, your back end fulfilment service may have a process. Imagine when a package is accepted by your shipping partner, you look up the order, from which you look up the user, from which you take the token, and send a push to say &quot;your order has shipped&quot;.</li>
</ol>
<p class="blog-text text-justify">Still with me? Great. In order to handle the business logic for this on the server side, we encapsulate this in a couple of simple rules. Let&#x27;s take you through them.</p>
<p class="blog-text text-justify"><strong>Rule 1: A token can only be owned by 1 user and 1 user only.</strong></p>
<p class="blog-text text-justify">This one is simple. When the app gives the token to the server it should be associated with 1 user on your service. Imagine I have an account on your server, and I get a token. I give it to your server. When my product shipped, I should be the only person informed of this.</p>
<p class="blog-text text-justify">How could it occur that a token is on more than 1 user? Well, it shouldn&#x27;t. But imagine I have the app installed. I log out. I give the phone as a hand-me-down to my daughter. She logs into her account, and gives what might be the same token to your server. The token should not be associated with my account and her account. It&#x27;s up to you to notice that a token is already associated with 1 user, and you should remove it from me, and &quot;give&quot; it to her.</p>
<p class="blog-text text-justify">Here&#x27;s some crude pseudocode</p>
<p class="blog-text text-justify"><code>update user set token = nil where token = &#x27;&lt;given token&gt;&#x27;</code><br/>
<code>update user set token = &#x27;&lt;given token&gt;&#x27; where user_id = &lt;logged in user id&gt;</code></p>
<p class="blog-text text-justify"><strong>Rule 2: A user may have more than one token</strong></p>
<p class="blog-text text-justify">Why can users have more than one token? That&#x27;s simple too. Imagine I own an iPhone and an iPad, and I&#x27;m logged into your shop on each. Frankly, I want to shop with whichever device is nearest my hand.</p>
<p class="blog-text text-justify">Now, when my product ships, it makes sense to send a push to both. Either device may be nearby. So, allow for multiple tokens per user.</p>
<h2 class="blog-subtitle ">Putting this together</h2>
<p class="blog-text text-justify">This is quite simple, but there&#x27;s a couple of gotchas:</p>
<ol>
<li class="list-disc ml-5 my-1">Typically, in the app it may request the token and attempt a login to your service. Both of these are asynchronous events. Your app code should wait for both of these to finish before sending the token to the server. Remember, you are typically trying to associate a token to a user.</li>
<li class="list-disc ml-5 my-1">There may be a good case for de-associating a token from a user. If your app has a logout capability, it should inform the server that the token should be de-associated from the user. If we consider the above example, I should not receive a message about my shipped parcel if I have subsequently logged out of the app. So, you may need to supply an API for this specific use case.</li>
<li class="list-disc ml-5 my-1">Your push provider (or if you&#x27;re going direct to Apple/Google) will have a capability to inform your server of <em>stale tokens</em>. A stale token is a token the network knows is no longer going to work. For example: A user may have uninstalled your app without logout. If you attempt to send them a push, it will fail, and the token will be marked as stale (essentially: The Operating System on the handset will have informed the network of this fact). How you find out about stale tokens varies depending on who you use, but the simple rule here is: <strong>remove stale tokens. They are of no use to you.</strong></li>
</ol>
<p class="blog-text text-justify">If you follow these simple rules, your push capability will work as you expect.</p></section></div> </main><footer class="p-10 bg-[#eeeeee90] text-[#A09893] "><div class="app-container footer"><div><img src="/Tapadoo-site/_next/static/media/tapadoo-large-logo.b51a8a63.png" alt="Tapadoo logo" class="w-full max-w-[120px] cursor-pointer grayscale"/><div class="my-4"><p>26-28 Strand Street Great, Dublin 1 </p><a href="mailto:enquiries@tapadoo.com">enquiries@tapadoo.com</a></div><a href="tel:3531123456">+353 1 123456</a></div><div><span class="footer-title">Links</span><a class="link link-hover" href="/Tapadoo-site/tapadoo/contact">Privacy Policy</a><a class="link link-hover" href="/Tapadoo-site/tapadoo/contact">Support</a></div><div><span class="footer-title">Company</span><a class="link link-hover" href="/Tapadoo-site/tapadoo/about">About us</a><a class="link link-hover" href="/Tapadoo-site/tapadoo/careers">Careers</a><a class="link link-hover" href="/Tapadoo-site/apps/costs">Pricing</a><a class="link link-hover" href="/Tapadoo-site/blog/1">Blog</a></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Simple Rules for managing Push Tokens","date":"2019-08-26","content":"\nSometimes, we develop an app for customers where they are implementing their own back-end services. The issue of handling push tokens regularly comes up. Often, the business logic may seem difficult to manage all the scenarios, but it really isn't that difficult. Let's take a typical example. In most cases, your service will want to associate a push token with a user on your service. Imagine your app is a shop, and you want to be able to send a push notification when a product ships.\n\nFirstly a little background on how push works. Essentially there a couple of aspects to push:\n\n1. Push is decided by a user permission. The first time an app wishes to use push, the operating system will kick in and ask the user's permission. If the user doesn't want to receive push, they can say no. This is the end of it. You won't get any tokens. This is fine. You're meant to respect the user's wishes. In this case the user is saying \"Don't tell me when my product ships, I'll come back and check myself\"\n2. If permission is granted, the app will request a push token from the network (i.e. from Apple or Google depending on iOS or Android).\n3. The token will be given by the network. It represents a unique device _and an app_. I.e. any push sent to this token will be delivered to this device and this app on the device only.\n4. Typically, your app code will hand this token to the server to be associated with the logged in user to the service (i.e. \"which user is logged into this online shop? this is now their token which you can use to let them know when their next purchase ships\")\n5. When the business conditions are fulfilled, the server will initiate the push. So, for example, your back end fulfilment service may have a process. Imagine when a package is accepted by your shipping partner, you look up the order, from which you look up the user, from which you take the token, and send a push to say \"your order has shipped\".\n\nStill with me? Great. In order to handle the business logic for this on the server side, we encapsulate this in a couple of simple rules. Let's take you through them.\n\n**Rule 1: A token can only be owned by 1 user and 1 user only.**\n\nThis one is simple. When the app gives the token to the server it should be associated with 1 user on your service. Imagine I have an account on your server, and I get a token. I give it to your server. When my product shipped, I should be the only person informed of this.\n\nHow could it occur that a token is on more than 1 user? Well, it shouldn't. But imagine I have the app installed. I log out. I give the phone as a hand-me-down to my daughter. She logs into her account, and gives what might be the same token to your server. The token should not be associated with my account and her account. It's up to you to notice that a token is already associated with 1 user, and you should remove it from me, and \"give\" it to her.\n\nHere's some crude pseudocode\n\n`update user set token = nil where token = '\u003cgiven token\u003e'`  \n`update user set token = '\u003cgiven token\u003e' where user_id = \u003clogged in user id\u003e`\n\n**Rule 2: A user may have more than one token**\n\nWhy can users have more than one token? That's simple too. Imagine I own an iPhone and an iPad, and I'm logged into your shop on each. Frankly, I want to shop with whichever device is nearest my hand.\n\nNow, when my product ships, it makes sense to send a push to both. Either device may be nearby. So, allow for multiple tokens per user.\n\n## Putting this together\n\nThis is quite simple, but there's a couple of gotchas:\n\n1. Typically, in the app it may request the token and attempt a login to your service. Both of these are asynchronous events. Your app code should wait for both of these to finish before sending the token to the server. Remember, you are typically trying to associate a token to a user.\n2. There may be a good case for de-associating a token from a user. If your app has a logout capability, it should inform the server that the token should be de-associated from the user. If we consider the above example, I should not receive a message about my shipped parcel if I have subsequently logged out of the app. So, you may need to supply an API for this specific use case.\n3. Your push provider (or if you're going direct to Apple/Google) will have a capability to inform your server of _stale tokens_. A stale token is a token the network knows is no longer going to work. For example: A user may have uninstalled your app without logout. If you attempt to send them a push, it will fail, and the token will be marked as stale (essentially: The Operating System on the handset will have informed the network of this fact). How you find out about stale tokens varies depending on who you use, but the simple rule here is: **remove stale tokens. They are of no use to you.**\n\nIf you follow these simple rules, your push capability will work as you expect.\n","postImage":"https://2upm2b1wdft320vzjj34rpga-wpengine.netdna-ssl.com/wp-content/uploads/2019/04/Screenshot-2019-04-25-10.32.45.png.webp"}},"__N_SSG":true},"page":"/blog/post/[slug]","query":{"slug":"simple-rules-for-managing-push-tokens"},"buildId":"jG6HNdE2cjk8s5SucJ8mC","assetPrefix":"/Tapadoo-site","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>
<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Blog | Tapadoo </title><meta name="next-head-count" content="3"/><link rel="preload" href="/Tapadoo-site/_next/static/css/7d273cea23613d33.css" as="style"/><link rel="stylesheet" href="/Tapadoo-site/_next/static/css/7d273cea23613d33.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/Tapadoo-site/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/Tapadoo-site/_next/static/chunks/webpack-461e027a94344cdf.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/framework-715a76d8b0695da7.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/main-baed5792d4d394cf.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/pages/_app-c68c249bf95195e7.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/996-f765e51b6a74c60f.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/402-722b6745331d1e2f.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/249-fcf6883dd3036349.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/pages/blog/post/%5Bslug%5D-daf066f3e0730dd6.js" defer=""></script><script src="/Tapadoo-site/_next/static/HtA55eRcY1W8JTzXh5sZJ/_buildManifest.js" defer=""></script><script src="/Tapadoo-site/_next/static/HtA55eRcY1W8JTzXh5sZJ/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-base-100 shadow-sm z-50"><header class="navbar max-w-7xl mx-auto "><div class="navbar-start"><a href="/Tapadoo-site"><img src="/Tapadoo-site/_next/static/media/tapadoo-large-logo.b51a8a63.png" alt="Tapadoo logo" class="w-full max-w-[120px] cursor-pointer"/></a></div><div class="navbar-end md:hidden flex"><div class="dropdown dropdown-left"><label tabindex="0" class="btn btn-ghost lg:hidden"><button><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor"></path><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor"></path><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor"></path></svg></button></label><ul class="menu menu-compact dropdown-content mt-3 p-2 shadow bg-base-100 rounded-box w-52 z-50"><li><a class="font-semibold  " href="/Tapadoo-site/tapadoo/about">Tapadoo</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/about">Who are you?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/localization">Where are you based?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/work">Who do you work with?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/careers">Are you hiring?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/contact">Get in touch</a></li><li><a class="font-semibold  " href="/Tapadoo-site/apps/requisites">Apps</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/requisites">Do I need an app?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/costs">How much does an app cost?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/success-cases">Case Studies</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/process">Process</a></li><li><a class="font-semibold  " href="/Tapadoo-site/blog/1">Blog</a></li></ul></div></div><div class="navbar-end hidden md:flex"><ul class="menu menu-horizontal p-0"><li><a class="  " href="/Tapadoo-site/tapadoo/about">Tapadoo</a></li><li><a class="  " href="/Tapadoo-site/apps/requisites">Apps</a></li><li><a class="  " href="/Tapadoo-site/blog/1">Blog</a></li></ul></div></header></div><main class="min-h-[70vh] relative"> <div class="p-4 max-w-5xl mx-auto mt-[5vh]"><figure><img src="https://cdn-bhcgp.nitrocdn.com/lQsUIlYWTGkhjqgYKmLJkHSBczAwGDPM/assets/static/optimized/rev-f8d7f54/wp-content/uploads/2019/01/sam-truong-dan-627874-unsplash.jpg.webp" alt="EC2 instances and how to prevent unexpected billsTapadoo blog" class="rounded-xl max-w-[90vw] mx-auto w-full"/></figure><section class="mb-10"><h1 class="app-title my-8">EC2 instances and how to prevent unexpected bills</h1><div class="w-full bg-neutral h-[1px] my-8 opacity-60"></div><p class="blog-text text-justify">The benefits of <a class="text-primary " href="https://aws.amazon.com/what-is-cloud-computing/">Cloud Computing</a> and on-demand computing environments are pretty well known.</p>
<p class="blog-text text-justify">One such service is <a class="text-primary " href="https://aws.amazon.com/ec2/">EC2</a> from Amazon, which allows business subscribers to run application programs in the computing environment. The EC2 serves as an almost unlimited set of virtual machines.</p>
<p class="blog-text text-justify">This is a great service for just a few dollars a day. However, sometimes due to a simple oversight we can be burdened with large unexpected bills by forgetting to shut down a virtual server.</p>
<h2 class="blog-subtitle ">Running an EC2 instance</h2>
<p class="blog-text text-justify">As developers, we sometimes need to run an EC2 instance to run some temporary workloads. We do this because these workloads need more resources than what’s available on our developer machine. It’s generally for a process that needs a massive amount of RAM, like when testing data transformation for an in-memory database.</p>
<p class="blog-text text-justify">It’s amazing that we have such massive compute power on-demand for a few dollars a day. However, sometimes those few dollars a day, can become a headache at the end of the month.</p>
<p class="blog-text text-justify">We might need the big instance for four or five hours work. We complete the job, validate the results and congratulate ourselves on a job well done. But, we go home and forget to stop the instance.</p>
<p class="blog-text text-justify">This can result in the aforementioned unexpected bills.</p>
<h2 class="blog-subtitle ">Preventing unexpected bills with EC2</h2>
<p class="blog-text text-justify">What would be the simplest way to resolve this without investing too much time and effort into it?</p>
<p class="blog-text text-justify">Could we launch a self-stopping instance?</p>
<p class="blog-text text-justify">A search led us to <a class="text-primary " href="https://stackoverflow.com/a/38186787/125629">this Stack Overflow answer</a>:</p>
<p class="blog-text text-justify">$ echo &#x27;#!/bin/sh&#x27; &gt; per-boot.sh
$ echo &#x27;echo &quot;halt&quot; | at now + 1 hour&#x27; &gt;&gt; per-boot.sh
$ echo &#x27;echo per-boot: `date` &gt;&gt; /tmp/per-boot.txt&#x27; &gt;&gt; per-boot.sh
$ chmod +x per-boot.sh
$ sudo chown -R root per-boot.sh
$ sudo mv -viu per-boot.sh /var/lib/cloud/scripts/per-boot</p>
<p class="blog-text text-justify">This introduced us to <a class="text-primary " href="https://cloudinit.readthedocs.io/en/latest/">Cloud-Init</a> “the defacto multi-distribution package that handles early initialization of a cloud instance.”</p>
<p class="blog-text text-justify">An investigation into Cloud-Init and <a class="text-primary " href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html">EC2 User-Data</a> led us to our solution.  Use the following as the instance User-Data before launching the instance:</p>
<p class="blog-text text-justify">#cloud-config
cloud_final_modules:</p>
<ul>
<li class="list-disc ml-5 my-1">[scripts-user, always]
runcmd:</li>
<li class="list-disc ml-5 my-1">&#x27;echo &quot;per-boot start: `date`&quot; &gt;&gt; /tmp/per-boot.txt&#x27;</li>
<li class="list-disc ml-5 my-1">&#x27;echo &quot;sudo shutdown now&quot; | at now + 1 hour&#x27;</li>
</ul>
<p class="blog-text text-justify">The first <code>runcmd</code> runs every time the instance is booted and appends a timestamp to a simple log file. By inspecting this file, you&#x27;ll be able to see how many times the instance has been started, and you can easily see the last time it started too.</p>
<p class="blog-text text-justify">The second <code>runcmd</code> schedules the <code>shutdown</code> command to run in one hours time. We’re using the <a class="text-primary " href="https://www.computerhope.com/unix/uat.htm">at command</a> to schedule the call. This is a very versatile command and gives you plenty of scope to tailor how long you want your instance to run.</p>
<p class="blog-text text-justify">We have tested this <code>User-Data</code> on Ubuntu 16.10 and Amazon Linux 2 images. For it to work on Debian 9 you will need to have the `at` command installed so an additional `runcmd` is needed:</p>
<p class="blog-text text-justify">- &#x27;apt-get install -y at&#x27;</p>
<p class="blog-text text-justify">Hopefully, this is straight-forward enough to save forgetful humans (like me) some money.</p>
<p class="blog-text text-justify">John Keyes</p>
<p class="blog-text text-justify">Server Side Developer</p></section></div> </main><footer class="p-10 bg-[#eeeeee90] text-[#A09893] "><div class="app-container footer"><div><img src="/Tapadoo-site/_next/static/media/tapadoo-large-logo.b51a8a63.png" alt="Tapadoo logo" class="w-full max-w-[120px] cursor-pointer grayscale"/><div class="my-4"><a href="https://goo.gl/maps/8Q1WtLmA8t41bNnJ6"><p aria-label="Tapadoo location" class="my-2">26-28 Strand Street Great, Dublin 1 </p></a><a href="mailto:enquiries@tapadoo.com "><p aria-label="Tapadoo mail" class="">enquiries@tapadoo.com </p></a></div><a href="tel:+353 1 555 222 4"><p aria-label="Tapadoo Phone" class="">+353 1 555 222 4</p></a></div><div><span class="footer-title">Links</span><a class="link link-hover" href="/Tapadoo-site/tapadoo/contact">Privacy Policy</a></div><div><span class="footer-title">Company</span><a class="link link-hover" href="/Tapadoo-site/tapadoo/about">About us</a><a class="link link-hover" href="/Tapadoo-site/tapadoo/careers">Careers</a><a class="link link-hover" href="/Tapadoo-site/apps/costs">Pricing</a><a class="link link-hover" href="/Tapadoo-site/blog/1">Blog</a></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"EC2 instances and how to prevent unexpected bills","date":"2019-02-11","content":"\nThe benefits of [Cloud Computing](https://aws.amazon.com/what-is-cloud-computing/) and on-demand computing environments are pretty well known.\n\nOne such service is [EC2](https://aws.amazon.com/ec2/) from Amazon, which allows business subscribers to run application programs in the computing environment. The EC2 serves as an almost unlimited set of virtual machines.\n\nThis is a great service for just a few dollars a day. However, sometimes due to a simple oversight we can be burdened with large unexpected bills by forgetting to shut down a virtual server.\n\n## Running an EC2 instance\n\nAs developers, we sometimes need to run an EC2 instance to run some temporary workloads. We do this because these workloads need more resources than what’s available on our developer machine. It’s generally for a process that needs a massive amount of RAM, like when testing data transformation for an in-memory database.\n\nIt’s amazing that we have such massive compute power on-demand for a few dollars a day. However, sometimes those few dollars a day, can become a headache at the end of the month.\n\nWe might need the big instance for four or five hours work. We complete the job, validate the results and congratulate ourselves on a job well done. But, we go home and forget to stop the instance.\n\nThis can result in the aforementioned unexpected bills.\n\n## Preventing unexpected bills with EC2\n\nWhat would be the simplest way to resolve this without investing too much time and effort into it?\n\nCould we launch a self-stopping instance?\n\nA search led us to [this Stack Overflow answer](https://stackoverflow.com/a/38186787/125629):\n\n$ echo '#!/bin/sh' \u003e per-boot.sh\n$ echo 'echo \"halt\" | at now + 1 hour' \u003e\u003e per-boot.sh\n$ echo 'echo per-boot: \\`date\\` \u003e\u003e /tmp/per-boot.txt' \u003e\u003e per-boot.sh\n$ chmod +x per-boot.sh\n$ sudo chown -R root per-boot.sh\n$ sudo mv -viu per-boot.sh /var/lib/cloud/scripts/per-boot\n\nThis introduced us to [Cloud-Init](https://cloudinit.readthedocs.io/en/latest/) “the defacto multi-distribution package that handles early initialization of a cloud instance.”\n\nAn investigation into Cloud-Init and [EC2 User-Data](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html) led us to our solution.  Use the following as the instance User-Data before launching the instance:\n\n#cloud-config\ncloud\\_final\\_modules:\n- \\[scripts-user, always\\]\nruncmd:\n- 'echo \"per-boot start: \\`date\\`\" \u003e\u003e /tmp/per-boot.txt'\n- 'echo \"sudo shutdown now\" | at now + 1 hour'\n\nThe first `runcmd` runs every time the instance is booted and appends a timestamp to a simple log file. By inspecting this file, you'll be able to see how many times the instance has been started, and you can easily see the last time it started too.\n\nThe second `runcmd` schedules the `shutdown` command to run in one hours time. We’re using the [at command](https://www.computerhope.com/unix/uat.htm) to schedule the call. This is a very versatile command and gives you plenty of scope to tailor how long you want your instance to run.\n\nWe have tested this `User-Data` on Ubuntu 16.10 and Amazon Linux 2 images. For it to work on Debian 9 you will need to have the \\`at\\` command installed so an additional \\`runcmd\\` is needed:\n\n\\- 'apt-get install -y at'\n\nHopefully, this is straight-forward enough to save forgetful humans (like me) some money.\n\nJohn Keyes\n\nServer Side Developer\n","postImage":"https://cdn-bhcgp.nitrocdn.com/lQsUIlYWTGkhjqgYKmLJkHSBczAwGDPM/assets/static/optimized/rev-f8d7f54/wp-content/uploads/2019/01/sam-truong-dan-627874-unsplash.jpg.webp"}},"__N_SSG":true},"page":"/blog/post/[slug]","query":{"slug":"ec2-prevent-unexpected-bills"},"buildId":"HtA55eRcY1W8JTzXh5sZJ","assetPrefix":"/Tapadoo-site","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>
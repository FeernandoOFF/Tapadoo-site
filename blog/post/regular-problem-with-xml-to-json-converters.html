<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Blog | Tapadoo </title><meta name="next-head-count" content="3"/><link rel="preload" href="/Tapadoo-site/_next/static/css/a0d44aa37cf6330f.css" as="style"/><link rel="stylesheet" href="/Tapadoo-site/_next/static/css/a0d44aa37cf6330f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/Tapadoo-site/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/Tapadoo-site/_next/static/chunks/webpack-461e027a94344cdf.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/framework-715a76d8b0695da7.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/main-baed5792d4d394cf.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/pages/_app-c68c249bf95195e7.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/996-f765e51b6a74c60f.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/402-722b6745331d1e2f.js" defer=""></script><script src="/Tapadoo-site/_next/static/chunks/pages/blog/post/%5Bslug%5D-720d9d7269f2dce5.js" defer=""></script><script src="/Tapadoo-site/_next/static/n9cWt2i2X49CTP55VazPm/_buildManifest.js" defer=""></script><script src="/Tapadoo-site/_next/static/n9cWt2i2X49CTP55VazPm/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="bg-base-100 shadow-sm z-50"><header class="navbar max-w-7xl mx-auto "><div class="navbar-start"><a href="/Tapadoo-site"><img src="/Tapadoo-site/_next/static/media/tapadoo-large-logo.b51a8a63.png" alt="Tapadoo logo" class="w-full max-w-[120px] cursor-pointer"/></a></div><div class="navbar-end md:hidden flex"><div class="dropdown dropdown-left"><label tabindex="0" class="btn btn-ghost lg:hidden"><button><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor"></path><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor"></path><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor"></path></svg></button></label><ul class="menu menu-compact dropdown-content mt-3 p-2 shadow bg-base-100 rounded-box w-52 z-50"><li><a class="font-semibold  " href="/Tapadoo-site/tapadoo/about">Tapadoo</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/about">Who are you?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/localization">Where are you based?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/work">Who do you work with?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/careers">Are you hiring?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/tapadoo/contact">Get in touch</a></li><li><a class="font-semibold  " href="/Tapadoo-site/apps/requisites">Apps</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/requisites">Do I need an app?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/costs">How much does an app cost?</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/success-cases">Case Studies</a><a class=" border my-2  border-transparent" href="/Tapadoo-site/apps/process">Process</a></li><li><a class="font-semibold  " href="/Tapadoo-site/blog/1">Blog</a></li></ul></div></div><div class="navbar-end hidden md:flex"><ul class="menu menu-horizontal p-0"><li><a class="  " href="/Tapadoo-site/tapadoo/about">Tapadoo</a></li><li><a class="  " href="/Tapadoo-site/apps/requisites">Apps</a></li><li><a class="  " href="/Tapadoo-site/blog/1">Blog</a></li></ul></div></header></div><main class="min-h-[70vh] relative"> <div class="p-4 max-w-5xl mx-auto mt-[5vh]"><figure><img src="https://2upm2b1wdft320vzjj34rpga-wpengine.netdna-ssl.com/wp-content/uploads/2019/04/tapadoo_background_linkedin.png.webp" alt="Regular problem with XML to JSON ConvertersTapadoo blog" class="rounded-xl max-w-[90vw] mx-auto w-full"/></figure><section class="mb-10"><h1 class="app-title my-8">Regular problem with XML to JSON Converters</h1><div class="categories"><p class="my-4 text-lg font-medium">Tags : </p><p class="p-2 text-xs px-4 bg-neutral rounded-lg inline-block text-gray-100 font-semibold cursor-pointer">development</p><p class="p-2 text-xs px-4 bg-neutral rounded-lg inline-block text-gray-100 font-semibold cursor-pointer">iphone</p><p class="p-2 text-xs px-4 bg-neutral rounded-lg inline-block text-gray-100 font-semibold cursor-pointer">iphonedev</p></div><div class="w-full bg-neutral h-[1px] my-8 opacity-60"></div><p class="blog-text text-justify">Here at tapadoo, we&#x27;ve done a number of apps which communicate with back end data servers. Typically this means a RESTful API with JSON or XML payloads. There&#x27;s one issue we&#x27;ve come across on a number of projects, where we&#x27;re dealing with an existing Web API which is presenting the payloads in JSON. The problem is where arrays are incorrectly serialized in certain cases. Specifically we&#x27;ve seen:</p>
<ul>
<li class="list-disc ml-5 my-1">When an array has more than 1 entry, it is serialized correctly</li>
<li class="list-disc ml-5 my-1">When the array has only 1 entry, it is serialized not as an array, but as a single dictionary.</li>
</ul>
<p class="blog-text text-justify"><strong>Firstly, lets explain why this has occurred</strong> If you consider the following XML:</p>
<!-- -->&lt;team&gt;
    &lt;employee&gt;
      &lt;name&gt;Joe&lt;/name&gt;
      &lt;surname&gt;Bloggs&lt;/surname&gt;
  &lt;/employee&gt;
  &lt;employee&gt;
    &lt;name&gt;Jane&lt;/name&gt;
    &lt;surname&gt;Doe&lt;/surname&gt;
  &lt;/employee&gt;
&lt;/team&gt;<!-- -->
<p class="blog-text text-justify">A typical XML to JSON converter will convert this as follows:</p>
<p class="blog-text text-justify">{
team:{
employee:[
{
name:&#x27;Joe&#x27;,
surname:&#x27;Bloggs&#x27;
},
{
name:&#x27;Jane&#x27;,
surname:&#x27;Doe&#x27;
}
]
}
}</p>
<p class="blog-text text-justify">I.e It is converted to a Dictionary, with a key called &#x27;team&#x27; whose value is a Dictionary, with a key called &#x27;employee&#x27; which is an array of Dictionaries (with keys of &#x27;name&#x27; and &#x27;surname&#x27;).</p>
<p class="blog-text text-justify">Great. However if the XML was a team with a single entry:</p>
<!-- -->&lt;team&gt;
    &lt;employee&gt;
      &lt;name&gt;Joe&lt;/name&gt;
      &lt;surname&gt;Bloggs&lt;/surname&gt;
  &lt;/employee&gt;
&lt;/team&gt;<!-- -->
<p class="blog-text text-justify">The XML to JSON converter has no context on Employee. It has now way of knowing that this is potentially a repeating group (especially if it has no XSD to consult), so it converts the XML to the following JSON:</p>
<p class="blog-text text-justify">{
team:{
employee:{
name:&#x27;Joe&#x27;,
surname:&#x27;Bloggs&#x27;
}
}
}</p>
<p class="blog-text text-justify">So, this is now a Dictionary, with a key called &#x27;team&#x27; whose value is a dictionary with a key called &#x27;employee&#x27; whose value is a Dictionary.</p>
<p class="blog-text text-justify">The problem here is when we go to parse, we expect the value of &#x27;employee&#x27; to be an array (which it isn&#x27;t), and this can lead to problems in the code.</p>
<p class="blog-text text-justify">And..due to Objective-C loose approach to type, the following code will run: <code>NSArray *array = [teamDict objectForKey:@&quot;employee&quot;];</code></p>
<p class="blog-text text-justify">In those cases where there team has a number of employees, the above code works fine, and the pointer, array stores an array. In those cases where a team as a single employee, the above code runs, however the pointer, array will actually point to a NSDictionary. So the following code (for example) <code>int numEntries = [array count];</code> Will sometimes work, and sometimes lead to a runtime error, which on iPhone will manifest itself as a crash.</p>
<p class="blog-text text-justify"><strong>So how do we fix this?</strong> Well, if you have control over the server side, the simple question is to fix it in the first place. Note: This is a common problem with JAXB, a popular java XML binding mechanism often used in REST services written in Java. We&#x27;ve come across some examples on how to work around it <a class="text-primary " href="http://forums.netbeans.org/post-68036.html">here</a> and <a class="text-primary " href="http://jersey.576304.n2.nabble.com/Single-Element-Arrays-and-JSON-td5532105.html">here</a>.</p>
<p class="blog-text text-justify">If you have no control over this, you may be able to handle this in your Objective-C code. Here&#x27;s some sample code we&#x27;ve started to use; It checks the data type at runtime, and if necessary, converts it to a single element array</p>
<p class="blog-text text-justify">+(NSArray *) getArrayFromJSONDictionary:(NSDictionary *)parent
forKey:(NSString *)key {
id obj = [parent objectForKey:key];
if([obj isKindOfClass:[NSArray class]]) {
return obj;
}
if([obj isEqual:[NSNull null]]) {
NSLog(@&quot;Warning: object for key %@ is null&quot;, key);
// Return an empty array
return [[[NSArray alloc] init] autorelease];
}
NSLog(@&quot;Warning object for key %@ is of type %@&quot;,
key, [[obj class] description]);
NSArray *ret = [NSArray arrayWithObject:obj];
return ret;
}</p></section></div> </main><footer class="p-10 bg-[#eeeeee90] text-[#A09893] "><div class="app-container footer"><div><img src="/Tapadoo-site/_next/static/media/tapadoo-large-logo.b51a8a63.png" alt="Tapadoo logo" class="w-full max-w-[120px] cursor-pointer grayscale"/><div class="my-4"><p>26-28 Strand Street Great, Dublin 1 </p><a href="mailto:enquiries@tapadoo.com">enquiries@tapadoo.com</a></div><a href="tel:3531123456">+353 1 123456</a></div><div><span class="footer-title">Links</span><a class="link link-hover" href="/Tapadoo-site/tapadoo/contact">Privacy Policy</a><a class="link link-hover" href="/Tapadoo-site/tapadoo/contact">Support</a></div><div><span class="footer-title">Company</span><a class="link link-hover" href="/Tapadoo-site/tapadoo/about">About us</a><a class="link link-hover" href="/Tapadoo-site/tapadoo/careers">Careers</a><a class="link link-hover" href="/Tapadoo-site/apps/costs">Pricing</a><a class="link link-hover" href="/Tapadoo-site/blog/1">Blog</a></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Regular problem with XML to JSON Converters","date":"2011-02-22","content":"\nHere at tapadoo, we've done a number of apps which communicate with back end data servers. Typically this means a RESTful API with JSON or XML payloads. There's one issue we've come across on a number of projects, where we're dealing with an existing Web API which is presenting the payloads in JSON. The problem is where arrays are incorrectly serialized in certain cases. Specifically we've seen:\n\n- When an array has more than 1 entry, it is serialized correctly\n- When the array has only 1 entry, it is serialized not as an array, but as a single dictionary.\n\n**Firstly, lets explain why this has occurred** If you consider the following XML:\n\n\u003cteam\u003e\n    \u003cemployee\u003e\n      \u003cname\u003eJoe\u003c/name\u003e\n      \u003csurname\u003eBloggs\u003c/surname\u003e\n  \u003c/employee\u003e\n  \u003cemployee\u003e\n    \u003cname\u003eJane\u003c/name\u003e\n    \u003csurname\u003eDoe\u003c/surname\u003e\n  \u003c/employee\u003e\n\u003c/team\u003e\n\nA typical XML to JSON converter will convert this as follows:\n\n{\n  team:{\n    employee:\\[\n      {\n        name:'Joe',\n        surname:'Bloggs'\n      },\n      {\n        name:'Jane',\n        surname:'Doe'\n      }\n    \\]\n  }\n}\n\nI.e It is converted to a Dictionary, with a key called 'team' whose value is a Dictionary, with a key called 'employee' which is an array of Dictionaries (with keys of 'name' and 'surname').\n\nGreat. However if the XML was a team with a single entry:\n\n\u003cteam\u003e\n    \u003cemployee\u003e\n      \u003cname\u003eJoe\u003c/name\u003e\n      \u003csurname\u003eBloggs\u003c/surname\u003e\n  \u003c/employee\u003e\n\u003c/team\u003e\n\nThe XML to JSON converter has no context on Employee. It has now way of knowing that this is potentially a repeating group (especially if it has no XSD to consult), so it converts the XML to the following JSON:\n\n{\n  team:{\n    employee:{\n      name:'Joe',\n      surname:'Bloggs'\n    }\n  }\n}\n\nSo, this is now a Dictionary, with a key called 'team' whose value is a dictionary with a key called 'employee' whose value is a Dictionary.\n\nThe problem here is when we go to parse, we expect the value of 'employee' to be an array (which it isn't), and this can lead to problems in the code.\n\nAnd..due to Objective-C loose approach to type, the following code will run: `NSArray *array = [teamDict objectForKey:@\"employee\"];`\n\nIn those cases where there team has a number of employees, the above code works fine, and the pointer, array stores an array. In those cases where a team as a single employee, the above code runs, however the pointer, array will actually point to a NSDictionary. So the following code (for example) `int numEntries = [array count];` Will sometimes work, and sometimes lead to a runtime error, which on iPhone will manifest itself as a crash.\n\n**So how do we fix this?** Well, if you have control over the server side, the simple question is to fix it in the first place. Note: This is a common problem with JAXB, a popular java XML binding mechanism often used in REST services written in Java. We've come across some examples on how to work around it [here](http://forums.netbeans.org/post-68036.html) and [here](http://jersey.576304.n2.nabble.com/Single-Element-Arrays-and-JSON-td5532105.html).\n\nIf you have no control over this, you may be able to handle this in your Objective-C code. Here's some sample code we've started to use; It checks the data type at runtime, and if necessary, converts it to a single element array\n\n+(NSArray \\*) getArrayFromJSONDictionary:(NSDictionary \\*)parent \n               forKey:(NSString \\*)key {\n  id obj = \\[parent objectForKey:key\\];\n  if(\\[obj isKindOfClass:\\[NSArray class\\]\\]) {\n    return obj;\n  }\n  if(\\[obj isEqual:\\[NSNull null\\]\\]) {\n    NSLog(@\"Warning: object for key %@ is null\", key);\n    // Return an empty array\n    return \\[\\[\\[NSArray alloc\\] init\\] autorelease\\];\n  }\n  NSLog(@\"Warning object for key %@ is of type %@\",\n        key, \\[\\[obj class\\] description\\]);\n  NSArray \\*ret = \\[NSArray arrayWithObject:obj\\];\n  return ret;\n}\n","postImage":"https://2upm2b1wdft320vzjj34rpga-wpengine.netdna-ssl.com/wp-content/uploads/2019/04/tapadoo_background_linkedin.png.webp","categories":["development","iphone","iphonedev"]}},"__N_SSG":true},"page":"/blog/post/[slug]","query":{"slug":"regular-problem-with-xml-to-json-converters"},"buildId":"n9cWt2i2X49CTP55VazPm","assetPrefix":"/Tapadoo-site","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>